<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>ISA Cultural Fest 2026 | The Imperial Archive</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Cormorant+Garamond:ital,wght@0,300;0,600;1,400&family=Montserrat:wght@200;400&display=swap" rel="stylesheet">
<script src="https://accounts.google.com/gsi/client" async defer></script>

<style>
:root {
  /* üèõÔ∏è Aristocratic Palette */
  --bone: #F9F7F2;      /* Off-white paper */
  --silk: #F0EDE5;      /* Secondary background */
  --gold-leaf: #BFA15E; /* Muted metallic gold */
  --royal-ink: #1A1C20; /* Deep charcoal/near black */
  --regal-navy: #2C3E50;
  
  --glass: rgba(255, 255, 255, 0.4);
  --border: 1px solid rgba(191, 161, 94, 0.3);
  --shadow-flat: 0 10px 30px rgba(0,0,0,0.05);
  
  --transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
}

* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: 'Cormorant Garamond', serif;
  background-color: var(--bone);
  color: var(--royal-ink);
  line-height: 1.6;
  overflow-x: hidden;
}

/* Subtle Royal Texture */
body::before {
  content: "";
  position: fixed;
  inset: 0;
  background-image: url("https://www.transparenttextures.com/patterns/cream-paper.png");
  opacity: 0.4;
  pointer-events: none;
  z-index: -1;
}

.container {
  width: min(1000px, 90%);
  margin: 0 auto;
}

/* --- HERO SECTION --- */
.hero {
  height: 90vh;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  text-align: center;
  border-bottom: var(--border);
}

.hero-label {
  font-family: 'Cinzel', serif;
  font-size: 12px;
  letter-spacing: 0.6rem;
  color: var(--gold-leaf);
  margin-bottom: 2rem;
  text-transform: uppercase;
}

.hero-title {
  font-family: 'Cormorant Garamond', serif;
  font-size: clamp(3.5rem, 10vw, 7.5rem);
  font-weight: 300;
  font-style: italic;
  margin: 0;
  line-height: 1;
}

.hero-sub {
  font-family: 'Montserrat', sans-serif;
  font-weight: 200;
  font-size: 14px;
  letter-spacing: 0.2rem;
  max-width: 500px;
  margin-top: 2rem;
  text-transform: uppercase;
  color: var(--regal-navy);
}

/* --- REGISTRY / FORM --- */
.registry { padding: 100px 0; }

.card {
  background: white;
  padding: 80px 40px;
  border: var(--border);
  box-shadow: var(--shadow-flat);
  position: relative;
}

/* Gold Frame Corners */
.card::before, .card::after {
  content: "";
  position: absolute;
  width: 20px;
  height: 20px;
  border: 1px solid var(--gold-leaf);
}
.card::before { top: 20px; left: 20px; border-right: 0; border-bottom: 0; }
.card::after { bottom: 20px; right: 20px; border-left: 0; border-top: 0; }

.card h2 {
  font-family: 'Cinzel', serif;
  font-size: 2rem;
  text-align: center;
  margin-bottom: 3rem;
  letter-spacing: 0.3rem;
}

.grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 40px;
}

@media(max-width: 768px) { .grid { grid-template-columns: 1fr; } }

.field { position: relative; }

.field label {
  font-family: 'Montserrat', sans-serif;
  font-size: 10px;
  letter-spacing: 0.15rem;
  text-transform: uppercase;
  color: var(--gold-leaf);
  display: block;
  margin-bottom: 8px;
}

input, select, textarea {
  width: 100%;
  border: none;
  border-bottom: 1px solid #DDD;
  background: transparent;
  font-family: 'Cormorant Garamond', serif;
  font-size: 1.2rem;
  padding: 10px 0;
  outline: none;
  transition: var(--transition);
}

input:focus, textarea:focus { border-bottom: 1px solid var(--gold-leaf); }

button.primary {
  width: 100%;
  margin-top: 60px;
  padding: 20px;
  background: var(--royal-ink);
  color: var(--bone);
  font-family: 'Cinzel', serif;
  letter-spacing: 0.4rem;
  border: none;
  cursor: pointer;
  transition: var(--transition);
}

button.primary:hover {
  background: var(--gold-leaf);
  color: white;
  letter-spacing: 0.5rem;
}

/* --- FEED / GALLERY --- */
.feed { padding: 100px 0; background: var(--silk); }

.feed-title {
  font-family: 'Cinzel', serif;
  text-align: center;
  margin-bottom: 4rem;
  font-size: 1.8rem;
}

.feed-item {
  background: white;
  border-bottom: 1px solid #EEE;
  padding: 60px;
  margin-bottom: 40px;
  text-align: center;
  transition: var(--transition);
}

.feed-item:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-flat);
}

.meta {
  font-family: 'Montserrat', sans-serif;
  font-size: 10px;
  letter-spacing: 0.2rem;
  color: var(--gold-leaf);
  margin-bottom: 1.5rem;
}

.quote {
  font-size: 2rem;
  font-style: italic;
  max-width: 800px;
  margin: 0 auto 1.5rem;
  color: var(--royal-ink);
}

.sig {
  font-family: 'Cinzel', serif;
  font-size: 12px;
  letter-spacing: 0.1rem;
  opacity: 0.7;
}

/* Redact Button Styling */
button.redact {
  margin-top: 20px;
  background: transparent;
  border: 1px solid #cc000033;
  color: #8B0000;
  font-family: 'Montserrat', sans-serif;
  font-size: 9px;
  padding: 8px 15px;
  cursor: pointer;
  letter-spacing: 1px;
}
</style>
</head>

<body>

<section class="hero">
  <div class="container">
    <div class="hero-label">The Sovereign Estate of</div>
    <h1 class="hero-title">ISA Cultural Fest</h1>
    <p class="hero-sub">The 2026 Archive &bull; A Legacy in Ink</p>
  </div>
</section>

<section class="registry">
  <div class="container">
    <div class="card">
      <h2>The Imperial Registry</h2>
      
      <div id="g_id_onload"
        data-client_id="671163289983-2056vpimutuatgerek6676pr1ob9p1n0.apps.googleusercontent.com"
        data-callback="handleCredentialResponse"
        data-auto_prompt="false"></div>
      <div class="g_id_signin" style="display:flex;justify-content:center;margin-bottom:48px;"></div>

      <div class="grid">
        <div class="field">
          <label>Origin Department</label>
          <select id="from"></select>
        </div>
        <div class="field">
          <label>Destined Department</label>
          <select id="to"></select>
        </div>
        <div class="field">
          <label>The Recipient</label>
          <input id="recipient" placeholder="Recipient name..." autocomplete="off" />
        </div>
        <div class="field">
          <label>Signature</label>
          <input id="signature" placeholder="Pseudonym or Blank" autocomplete="off" />
        </div>
        <div class="field" style="grid-column: 1 / -1;">
          <label>The Testimony</label>
          <textarea id="msg" placeholder="Write your contribution to history..."></textarea>
        </div>
      </div>

      <button class="primary" id="submit" disabled>ETCH INTO HISTORY</button>
      <div id="status" style="text-align:center; margin-top:15px; font-size:12px; letter-spacing:1px; color:var(--gold-leaf);">
        AUTHENTICATION REQUIRED
      </div>
    </div>
  </div>
</section>

<section class="feed">
  <div class="container">
    <h3 class="feed-title">The Gallery of Testimonies</h3>
    
    <div style="max-width:400px; margin: 0 auto 50px; text-align:center;">
        <input id="search2" style="text-align:center;" placeholder="Search the scrolls..." autocomplete="off" />
    </div>

    <div id="feed"></div>
  </div>
</section>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// Firebase Init
firebase.initializeApp({
  apiKey: "AIzaSyBfj4i0quFWPTHCdnC8GT3BSEsKvvvqzRA",
  authDomain: "isa-culturtal-fest-2026.firebaseapp.com",
  databaseURL: "https://isa-culturtal-fest-2026-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "isa-culturtal-fest-2026"
});
const db = firebase.database();

const roles = ["PR", "Finance", "Co-Presidents", "Helpers", "Activity Team", "HR Coordination", "Core Council", "Ambassadors", "Attendees"];
roles.forEach(r => {
  document.getElementById("from").add(new Option(r, r));
  document.getElementById("to").add(new Option(r, r));
});

let currentUser = null;

function decodeJwt(token){
  const base64Url = token.split('.')[1];
  const base64 = base64Url.replace(/-/g,'+').replace(/_/g,'/');
  return JSON.parse(atob(base64));
}

function handleCredentialResponse(response){
  const payload = decodeJwt(response.credential);
  currentUser = { id: payload.sub };
  document.getElementById("status").textContent = "VERIFIED BY THE CROWN";
  document.getElementById("submit").disabled = false;
}

const feedEl = document.getElementById("feed");
function el(tag, cls, text){
  const node = document.createElement(tag);
  if(cls) node.className = cls;
  if(text !== undefined) node.textContent = text;
  return node;
}

function renderFeedItem(item){
  const wrap = el("div", "feed-item");
  const meta = el("div", "meta", `${item.fromDept} ‚Ü† ${item.toDept}`);
  const quote = el("div", "quote", `‚Äú${item.message}‚Äù`);
  const sig = el("div", "sig", item.signature ? `‚Äî ${item.signature} for ${item.targetName}` : `‚Äî Refined for ${item.targetName}`);
  
  wrap.appendChild(meta);
  wrap.appendChild(quote);
  wrap.appendChild(sig);

  if(currentUser && item.authorId === currentUser.id){
    const btn = el("button", "redact", "REMOVE FROM ARCHIVE");
    btn.onclick = () => { if(confirm("Discard this record?")) db.ref("registry/"+item.id).remove(); };
    wrap.appendChild(btn);
  }
  return wrap;
}

// Submitting
document.getElementById("submit").onclick = () => {
  const targetName = document.getElementById("recipient").value;
  const message = document.getElementById("msg").value;
  if(!targetName || !message) return;

  const newKey = db.ref().child("registry").push().key;
  db.ref("registry/" + newKey).set({
    id: newKey,
    targetName,
    fromDept: document.getElementById("from").value,
    toDept: document.getElementById("to").value,
    message,
    signature: document.getElementById("signature").value || null,
    authorId: currentUser.id,
    timestamp: Date.now()
  });

  document.getElementById("recipient").value = "";
  document.getElementById("msg").value = "";
};

// Real-time Database
db.ref("registry").on("value", (snap) => {
  const data = snap.val();
  const items = data ? Object.values(data).sort((a,b) => b.timestamp - a.timestamp) : [];
  feedEl.innerHTML = "";
  items.forEach(i => feedEl.appendChild(renderFeedItem(i)));
});
</script>

</body>
</html>
